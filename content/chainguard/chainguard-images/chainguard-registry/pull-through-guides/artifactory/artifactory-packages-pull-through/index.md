---
title: "How to Pull Packages from Chainguard Package Repositories through Artifactory"
linktitle: "Package Pull-through"
aliases: 
- /chainguard/chainguard-registry/pull-through-guides/artifactory/artifactory-packages-pull-through/
type: "article"
description: "Tutorial outlining how to set up remote and virtual Artifactory repositories as pull-through caches for packages from Chainguard's package repositories."
date: 2024-11-14T15:56:52-07:00
lastmod: 2025-08-28T15:56:52-07:00
draft: false
tags: ["Chainguard Containers", "Procedural"]
images: []
menu:
  docs:
    parent: "artifactory"
toc: true
weight: 010
---

This tutorial outlines how to set up remote Alpine package repositories with [JFrog Artifactory](https://jfrog.com/artifactory/) that can be used as pull-through caches for Chainguard package repositories. Specifically, it will walk you through how to set up remote Artifactory repositories to serve as pull-through caches for a Chainguard private APK repository as well as Chainguard's public package repositories.

This guide will then outline how you can configure an image to pull APK packages from these remote repositories using tokens generated by Artifactory. It will also go over how you can use a virtual repository from Artifactory as a pull-through cache for Chainguard packages.


## Prerequisites

In order to complete this tutorial, you will need the following:

* Administrative privileges over an Artifactory instance. If you're interested in testing out this configuration, you can set up a trial instance on the [JFrog Artifactory landing page](https://jfrog.com/artifactory/).

> **Note**: As you follow this guide, you may run into issues if your Artifactory username is an email address; specifically, the `@` sign can lead to errors. For simplicity's sake, we recommend that you use a user profile with a name that only contains letters and numbers. If you must use an email address as your Artifactory username, though, this guide will include instructions for working around the issue.

* `chainctl` — Chainguard's command-line interface — installed on your local machine. If you haven't already done so, set this up by following our guide on [How to install `chainctl`](/chainguard/chainctl-usage/how-to-install-chainctl/).
* You must also have the ability to create role-bindings (`role_bindings.create`) within your Chainguard organization. This capability is available to users with certain rules, including [the `owner` role](https://edu.chainguard.dev/chainguard/administration/iam-organizations/roles-role-bindings/capabilities-reference/#chainguard-role-capabilities).


## Creating a Chainguard Pull Token for Remote Repository Authentication

When configuring an Artifactory remote repository to function as a pull-through cache for packages from a Chainguard [Chainguard Private APK Repository](/chainguard/chainguard-images/features/private-apk-repos/), the remote repository will need to authenticate to Chainguard in order to reach the private repository. This section outlines the steps necessary to create a Chainguard pull token and configure the required permissions to access your Chainguard organization's private APK repository.

First, set your Chainguard organization identifier as an environment variable. Be sure to replace the `example.org` placeholder with your organization's name as it appears in the Chainguard Console:

```shell
export CHAINGUARD_ORG=example.org
```

Next, generate a pull token:

```shell
chainctl auth pull-token --parent=${CHAINGUARD_ORG} -o env
```

This command creates a new pull token identity within your specified organization and outputs the credentials as `export` commands you can run to set them as environment variables:

```output
export CHAINGUARD_IDENTITY_ID=<id>
export CHAINGUARD_TOKEN=<token>
```

Run the first of these commands to create an environment variable for the identity ID:

```shell
export CHAINGUARD_IDENTITY_ID=<id>
```

You don't need to create the `CHAINGUARD_TOKEN` variable for the authentication token, but you should note the token value, as you'll need it when you create a remote Artifactory repository in the next section.

With the environment variables in place, create a role binding to grant the pull token identity the `apk.pull` role:

```shell
  chainctl iam role-bindings create \
    --parent=${CHAINGUARD_ORG} \
    --identity=${CHAINGUARD_IDENTITY_ID} \
    --role=apk.pull
```

This command binds the `apk.pull` role to your newly created identity, giving it the permissions needed to download packages from your organization's private APK repository.


## Setting Up a Pull-Through Cache for a Private APK Repository

Now that you have an identity with permissions to do so, you can set up a remote Artifactory repository that will use this identity to reach your private APK repository from Chainguard. 

> **Note**: This section provides a high-level overview of what you need to do to set up a remote repository as a pull-through cache for a private APK repo from Chainguard. For complete instructions on how to set up a remote repository in Artifactory, refer to [the official documentation](https://jfrog.com/help/r/jfrog-artifactory-documentation/remote-repositories). 

To get started, log in to the JFrog platform. Once there, select the **Administration** tab near the top of the screen and then select **Repositories** from the left-hand navigation menu. On the Repositories page, click the **Create a Repository** button and select the **Remote** option.

This will open a **Select Package Type** window where you must select the type of repository to set up. Because all packages offered by Chainguard are APKs, select **Alpine**.

This will take you to a **Basic** configuration tab where you can enter the following details:

* **Repository Key** — This is a name used to identify your remote repository. You can choose whatever name you like here, but this guide's examples will use the name `cg-private`.
* **URL** — This must be set to `https://apk.cgr.dev/${CHAINGUARD_ORG}`, but with your organization's actual name in place of `${CHAINGUARD_ORG}`. For example, if your organization is named `example.org` you would enter `https://apk.cgr.dev/example.org` here.
* **User Name** — This is used by Artifactory to authenticate to Chainguard and access your private APK repository. Here, add the pull token identity (the value you set to the `CHAINGUARD_IDENTITY_ID` variable earlier).
* **Password / Access Token** — This, along with the User Name, authenticates the Artifactory repository to access the remote private APK repository. Here, enter the token value you noted down after it was generated by the previous `chainctl auth pull-token` (`export CHAINGUARD_TOKEN=...`). 

Keep all the remaining fields set to their default values and click the **Create Remote Repository** button. This will create the remote repository and return you to the **Repositories** page. 


### Generating a token for the remote repository

Before testing whether you're able to pull packages through the remote Artifactory repository you just created, you will need to retrieve a token generated for it by Artifactory.

On the Repositories page, find your repository, click the ellipsis (**⋯**) all the way to the right of the repository's row, and then select **Set me up**. 

This will open a window from the right side of the page. Click the **Generate Token & Create Instructions** button, which will generate two code blocks whose contents you can copy. The first code block will contain the token you can use to access the remote Artifact repository. The second block will contain an `echo` command you can use to add a URL to an `/etc/apk/repositories` file. 

Copy or take note of the token generated for your repository. Then, run the following `export` commands to create an environment variable, replacing `my-token` with the token you noted down. You will use this environment variable in the next sections as you test out the remote repository:

```shell
export CG_PRIVATE_TOKEN=my-token
```

Additionally, create two more environment variables to hold your Artifactory user profile and hostname:

```shell
export ARTIFACTORY_USER_PROFILE=my-user-profile
export ARTIFACTORY_HOSTNAME=my-artifactory-hostname
```

If you aren't sure of these values, you can find them in the command from the **Set Up An Alpine Client** window where you found the token:

```shell
sudo sh -c "echo 'https://linky:<TOKEN>@example-hostname.jfrog.io/artifactory/cg-private/<BRANCH>/<REPOSITORY>'" >> /etc/apk/repositories
```

In this example, the Artifactory user profile is `linky` and the hostname is `example-hostname`.

> **Note**: If your Artifactory user profile is an email address, you will encounter an error unless you percent-encode the `@` sign, as in `export ARTIFACTORY_USER_PROFILE=linky%40example.com`. Here, the Artifactory user profile is `linky@example.com`, but it must be entered into the environment variable as `linky%40example.com`. 


## Testing Pull-Through from Private APK Repository

In order to test that you're able to pull packages from the remote Artifactory repository you just created, this section outlines how to build a container image (using a Chainguard image as a base) and configure it to pull packages from these repositories.

### Testing package pull-through interactively

Open a terminal and create a Dockerfile:

```shell
cat > Dockerfile <<EOF
FROM cgr.dev/chainguard/python:latest-dev
USER root
RUN mv /etc/apk/repositories /etc/apk/repositories.disabled
RUN echo 'https://$ARTIFACTORY_USER_PROFILE:$CG_PRIVATE_TOKEN@$ARTIFACTORY_HOSTNAME.jfrog.io/artifactory/cg-private/' >> /etc/apk/repositories
EOF
```

This Dockerfile uses the `python:latest-dev` image, but you can use any image which you have access to. However, after the image is built we will open up an interactive shell to test whether we can actually install packages from these repos with `apk`, so whatever image you use should be one that has a shell available. 

Note that this Dockerfile renames the default `/etc/apk/repositories` field. This isn't necessary, but doing so will allow you to ensure that you're actually downloading packages from the remote Artifactory repositories instead of the default ones. 

After creating the Dockerfile, use it to build a new image. Here, we tag the image `ar-interactive`:

```shell
docker build -t ar-interactive .
```

Once the image is built, run it. Be sure to include the `-it` and `--entrypoint` options to run it with an interactive shell:

```shell
docker run -it --entrypoint /bin/sh ar-interactive
```

Now that the container is running, you can check whether it was configured correctly and you can pull packages from the remote Artifactory repositories.

First check that the `/etc/apk/repositories` file contains the correct URL:

```container
cat /etc/apk/repositories
```
```output
https://$ARTIFACTORY_USER_PROFILE:$CG_PRIVATE_TOKEN@$ARTIFACTORY_HOSTNAME.jfrog.io/artifactory/cg-private/
```

Then test that you can install a package from these repositories with `apk`. This example installs the `npm` package:

```container
apk add npm
```

Be aware that you will only be able to add packages that are available from your organization's private APK repository. Refer to our [private APK repository documentation](/chainguard/chainguard-images/features/private-apk-repos/#about-private-apk-repositories) for more information.

This command's output shows that `npm` was indeed correctly installed from the remote Artifactory repository, which is itself pulling from the private APK repository:

```output
fetch https://<ARTIFACTORY-USER-PROFILE>:*@<ARTIFACTORY-HOSTNAME>.jfrog.io/artifactory/cg-private/x86_64/APKINDEX.tar.gz
(1/1) Installing npm (11.4.2-r1)
Executing busybox-1.37.0-r49.trigger
OK: 679 MiB in 76 packages
```

You can confirm this from the Artifactory dashboard with the [**Artifact Repository Browser**](https://jfrog.com/help/r/jfrog-artifactory-documentation/browsing-artifacts). Navigate to the **Platform** tab, then find **Artifactory** in the left-hand navigation menu and select **Artifacts**. From there, expand the menu option for the `cg-private` Artifactory repository. There, you will find the `npm` package listed, along with any other packages you've pulled through the remote repository.

### Testing pull-through within a build

You can also use the remote Artifactory repositories to install packages directly within a Dockerfile. 

To try this out, create another Dockerfile:

```shell
cat > Dockerfile.build <<EOF
FROM cgr.dev/chainguard/python:latest-dev
USER root
RUN mv /etc/apk/repositories /etc/apk/repositories.disabled
RUN echo 'https://$ARTIFACTORY_USER_PROFILE:$CG_PRIVATE_TOKEN@$ARTIFACTORY_HOSTNAME.jfrog.io/artifactory/cg-private/' >> /etc/apk/repositories
RUN apk add sed
USER nonroot
EOF
```

This example will install the `sed` package — from the `cg-private` remote repository — on the image as it is built.

After creating the Dockerfile, build the image. Note that this command includes the `-f` option to specify that it should build the image with the `Dockerfile.build` file you just created:

```shell
docker build -t ar-build -f Dockerfile.build .
```

Once again, you can confirm that the pull-through and caching worked as expected by checking the **Artifacts** page in the Artifactory dashboard.


## Configuring Pull-Through Caches for Chainguard's Public Repositories

Customers also have access to Chainguard's public `chainguard` and `extra-packages` repositories. To set up a pull-through cache for these package repositories on Artifactory, you can follow the same procedure outlined previously for the private APK repository.

You will need to create two remote repositories within Artifactory — one for each public package repo — by following the same steps as before: 

* **Repository Key** — This is the name used to identify your remote repository. Again, you can choose whatever names you like here but this guide's examples will use the names `cg-chainguard` and `cg-extras`.
* **URL** — This must be set to `https://virtualapk.cgr.dev/<ORGANIZATION-ID>/chainguard` for the `chainguard` repository and `https://virtualapk.cgr.dev/<ORGANIZATION-ID>/chainguard` for the `extra-packages` repository.
    * For both of these URLs, you will need to replace the `<ORGANIZATION-ID>` placeholder with your Chainguard organization's UID. You can find this by running the `chainctl iam organizations list -o table`; the UID will be the value in your organization's `ID` column. Alternatively, you can find it by checking the **Settings** ⇒ **General** page in the [Chainguard Console](https://console.chainguard.dev). 

You **do not** need to set any values for the **User Name** or **Password / Access Token** fields, as the public repositories do not require authentication. Keep all the remaining fields set to their default values and click the **Create Remote Repository** button. This will create the remote repository and return you to the **Repositories** page. 

After creating both repositories, generate and retrieve a token for each one as you did for the `cg-private` remote repository.

From the **Repositories** page, find both remote repositories you just created, and click on the ellipses (**⋯**) all the way to the right of their respective rows, click **Set me up**, and then click the **Generate Token & Create Instructions** button in the resulting window. 

Then, copy the resulting tokens to create a pair of environment variables. For the `cg-chainguard` repository's token:

```shell
export CG_TOKEN=<cg-chainguard-token>
```

Then for the `cg-extras` repo's token:

```shell
export EXTRAS_TOKEN=<cg-extras-token>
```

Following that, you can use these environment variables, along with a few created earlier in the guide, to create a Dockerfile as you previously did for the `cg-private` repository:

```shell
cat > Dockerfile.repos <<EOF
FROM cgr.dev/chainguard/python:latest-dev
USER root
RUN mv /etc/apk/repositories /etc/apk/repositories.disabled
RUN echo 'https://$ARTIFACTORY_USER_PROFILE:$CG_TOKEN@$ARTIFACTORY_HOSTNAME.jfrog.io/artifactory/cg-chainguard/' >> /etc/apk/repositories
RUN echo 'https://$ARTIFACTORY_USER_PROFILE:$EXTRAS_TOKEN@$ARTIFACTORY_HOSTNAME.jfrog.io/artifactory/cg-extras/' >> /etc/apk/repositories
RUN apk add c-ares
EOF
```

Following that, build the image:

```shell
docker build -t ar-repos -f Dockerfile.repos .
```

As this command runs, it will install the `c-ares` package into the image.


## Using a Virtual Repository as a Pull-Through Cache

Artifactory allows you to create what it refers to as *virtual repositories*. A virtual repository is a collection of one or more repositories (such as local, remote, or other virtual repositories) that have the same package type. The benefit of this is that you can access resources from multiple locations using a single logical URL.

> **Note**: This section provides a high-level overview of how to set up a virtual repository on Artifactory that you can use as a pull-through cache for Chainguard packages. For more information on Artifactory's virtual repositories, please refer to the [official documentation](https://jfrog.com/help/r/jfrog-artifactory-documentation/virtual-repositories).

To get started, create a new virtual repository. From the **Repositories** tab, click the **Create a Repository** button. This time, select the **Virtual** option, but instead of selecting the Alpine package type, select **Generic**.

You can use the Alpine package type, but [virtual Alpine repositories](https://jfrog.com/help/r/jfrog-artifactory-documentation/virtual-alpine-repositories) will only allow you to pull packages that have already been cached by an associated remote repository. A **Generic** artifact repository will provide more flexibility.

On the **New Virtual Repository** page, enter a key of your choosing into the **Repository Key** field.

Next, you must select existing repositories to include within this virtual repository. If you've been following along with this guide, you can test this out with the `cg-private, `cg-chainguard` and `cg-extras` repositories created previously.

Select your repositories by clicking their respective checkboxes. Then be sure to click the right-pointing chevron to move them to the **Selected Repositories** column. Finally, click the **Create Virtual Repository** button. 

As before, a window will appear letting you know that the repository was created successfully. Click the **Set Up Generic Client** button at the bottom of this window to retrieve the token you'll need to test whether you can pull images through this repository. 

With this token in hand, create another environment variable:

```shell
export VIRTUAL_TOKEN=my-virtual-repo-token
```

You'll use this token to create one more Dockerfile in the next section.

### Testing pull-through with a virtual package repository

To test out the virtual repository, create a Dockerfile that configures an image to use it as outlined previously. You can test this out however you like, but we will stick to one example here showing how to install a package into the built image:

```shell
cat > Dockerfile.virtual <<EOF
FROM cgr.dev/chainguard/python:latest-dev
USER root
RUN mv /etc/apk/repositories /etc/apk/repositories.disabled
RUN echo 'https://$ARTIFACTORY_USER_PROFILE:$VIRTUAL_TOKEN@$ARTIFACTORY_HOSTNAME.jfrog.io/artifactory/cg-apk-virt/' >> /etc/apk/repositories
RUN apk add stunnel
USER nonroot
EOF
```

After creating the Dockerfile, build the image:

```shell
docker build -t ar-virtual -f Dockerfile.virtual .
```

This example will install the `stunnel` package from the virtual repository as it builds the image.


## Debugging Pull-Through from Chainguard’s Package Repositories to Artifactory

If you run into issues when trying to pull from Chainguard's package repositories through Artifactory, you can try checking for these common pitfalls:

* You may run into issues if your Artifactory username is an email address; specifically, the `@` sign can lead to errors. Be sure that you're using a user profile with a name that only contains letters and numbers. If you must use a profile with an email address for a name, try percent-encoding the `@` sign by replacing it with `%40`.
* Ensure that all [network requirements](/chainguard/chainguard-images/network-requirements/) are met.
* When configuring a remote Artifactory repository, ensure that the **URL** field is set correctly. 
    * If necessary, ensure that you've set the correct UID for your organization in the URL field.
* It may help to [clear the Artifactory cache](https://jfrog.com/help/r/artifactory-cleanup-best-practices/clearing-an-oversized-cache).
* It could be that your Artifactory repository was misconfigured. In this case, create and configure a new Remote Artifactory repository to test with.


## Learn More

If you haven't already done so, you may find it useful to review our [Registry Overview](/chainguard/chainguard-registry/overview/) to learn more about Chainguard's registry. You can also learn more about Chainguard Containers by referring to our [documentation](/chainguard/chainguard-images/overview/), and learn more about working with the Chainguard platform by reviewing our [Administration documentation](/chainguard/administration/). If you'd like to learn more about JFrog Artifactory, we encourage you to refer to the [official Artifactory documentation](https://jfrog.com/help/r/jfrog-artifactory-documentation).
